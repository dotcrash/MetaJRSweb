{"remainingRequest":"F:\\HBuilderX软件\\Project\\brainHealth\\node_modules\\babel-loader\\lib\\index.js!F:\\HBuilderX软件\\Project\\brainHealth\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!F:\\HBuilderX软件\\Project\\brainHealth\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\HBuilderX软件\\Project\\brainHealth\\src\\views\\article\\sendArticle\\sendArticle.vue?vue&type=script&lang=js&","dependencies":[{"path":"F:\\HBuilderX软件\\Project\\brainHealth\\src\\views\\article\\sendArticle\\sendArticle.vue","mtime":1634182984000},{"path":"F:\\HBuilderX软件\\Project\\brainHealth\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1652873263289},{"path":"F:\\HBuilderX软件\\Project\\brainHealth\\node_modules\\babel-loader\\lib\\index.js","mtime":1652873271922},{"path":"F:\\HBuilderX软件\\Project\\brainHealth\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1652873263289},{"path":"F:\\HBuilderX软件\\Project\\brainHealth\\node_modules\\vue-loader\\lib\\index.js","mtime":1652873270400}],"contextDependencies":[],"result":["import \"core-js/modules/es6.array.some\";\nimport \"core-js/modules/es6.array.filter\";\nimport \"core-js/modules/es7.array.includes\";\nimport \"core-js/modules/es6.string.includes\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.array.for-each\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"F:\\\\HBuilderX\\u8F6F\\u4EF6\\\\Project\\\\brainHealth\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport \"core-js/modules/es6.function.name\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport E from \"wangeditor\";\nimport { articleSendApi, articleUpdate, getOneArticleInfo, deleteImg, uploadArticleImgApi } from \"@/api/api\";\nexport default {\n  name: \"sendArticle\",\n  data: function data() {\n    return {\n      form: {\n        //标题\n        title: \"\",\n        //展示部分内容\n        contentText: \"\",\n        //详情全部内容\n        contentHtml: \"\",\n        //用户id\n        userId: this.userId,\n        //图片\n        articleImgs: []\n      },\n      beforeArticleImgs: [],\n      editor: null,\n      showBtn: true,\n      isUpdate: this.$route.name == \"UpdateArticle\",\n      isNext: true\n    };\n  },\n  //跳转路由前判断是否继续编辑文章\n  beforeRouteLeave: function beforeRouteLeave(to, from, next) {\n    var _this = this;\n\n    //路由跳转到哪里\n    if (!this.isNext) return next(); //点击退出登录\n\n    if (this.$store.getters.getReadyLoginOut) {\n      this.$store.commit(\"setReadyLoginOut\", false);\n      this.outDelArticleImgs();\n      return next();\n    }\n\n    if (this.form.title || this.editor.txt.html()) {\n      this.$confirm(\"你在当前页面已经编辑了文章信息，离开当前页面将会丢失该页面的任何信息。是否继续?\", \"提示\", {\n        confirmButtonText: \"确定\",\n        cancelButtonText: \"取消\",\n        type: \"warning\"\n      }).then(function () {\n        _this.outDelArticleImgs();\n\n        next();\n      }).catch(function () {\n        return false;\n      });\n    } else {\n      next();\n    }\n  },\n  mounted: function mounted() {\n    this.initEditor();\n    this.getUpdateForm();\n  },\n  computed: {\n    userId: function userId() {\n      return this.$store.getters.getUser._id;\n    },\n    token: function token() {\n      return this.$store.getters.getToken;\n    }\n  },\n  methods: {\n    //创建wangEditor富文本编辑器\n    initEditor: function initEditor() {\n      var _this2 = this;\n\n      this.editor = new E(\"#editor\"); // 设置编辑区域高度\n\n      this.editor.config.height = 640; //改变默认的z-index\n\n      this.editor.config.zIndex = 500;\n      this.editor.config.placeholder = \"请输入文章内容\"; // 配置菜单栏，设置不需要的菜单\n\n      this.editor.config.excludeMenus = [\"video\"]; // 配置颜色（文字颜色、背景色）\n\n      this.editor.config.colors = [\"#ffffff\", \"#ff0000\", \"#ff9900\", \"#ffff00\", \"#00ff00\", \"#009933\", \"#3399ff\", \"#0000ff\", \"#000000\", \"#bf4080\", \"#00ffaa\", \"#ff3399\"]; // 配置行高\n\n      this.editor.config.lineHeights = [\"1\", \"1.2\", \"1.5\", \"2\", \"2.5\", \"3\"]; //来关闭样式过滤\n\n      this.editor.config.pasteFilterStyle = false;\n      this.editor.config.pasteIgnoreImg = false; //隐藏网络图片\n\n      this.editor.config.showLinkImg = false; // 上传超时时间\n\n      this.editor.config.uploadImgTimeout = 15 * 1000; // 当次最多上传图片个数\n\n      this.editor.config.uploadImgMaxLength = 5; // 图片大小最大为2M\n\n      this.editor.config.uploadImgMaxSize = 2 * 1024 * 1024; // 2M\n      // resultFiles 是 input 中选中的文件列表; insertImgFn 是获取图片 url 后，插入到编辑器的方法\n\n      this.editor.config.customUploadImg =\n      /*#__PURE__*/\n      function () {\n        var _ref = _asyncToGenerator(\n        /*#__PURE__*/\n        regeneratorRuntime.mark(function _callee2(resultFiles, insertImgFn) {\n          var formData, res;\n          return regeneratorRuntime.wrap(function _callee2$(_context2) {\n            while (1) {\n              switch (_context2.prev = _context2.next) {\n                case 0:\n                  formData = new FormData();\n                  resultFiles.forEach(\n                  /*#__PURE__*/\n                  function () {\n                    var _ref2 = _asyncToGenerator(\n                    /*#__PURE__*/\n                    regeneratorRuntime.mark(function _callee(item) {\n                      return regeneratorRuntime.wrap(function _callee$(_context) {\n                        while (1) {\n                          switch (_context.prev = _context.next) {\n                            case 0:\n                              formData.append(\"articleImg\", item);\n\n                            case 1:\n                            case \"end\":\n                              return _context.stop();\n                          }\n                        }\n                      }, _callee);\n                    }));\n\n                    return function (_x3) {\n                      return _ref2.apply(this, arguments);\n                    };\n                  }());\n                  _context2.next = 4;\n                  return uploadArticleImgApi(formData);\n\n                case 4:\n                  res = _context2.sent;\n\n                  if (res.code === 200) {\n                    res.data.forEach(function (item) {\n                      insertImgFn(item);\n\n                      _this2.form.articleImgs.push(item);\n                    });\n                  }\n\n                case 6:\n                case \"end\":\n                  return _context2.stop();\n              }\n            }\n          }, _callee2);\n        }));\n\n        return function (_x, _x2) {\n          return _ref.apply(this, arguments);\n        };\n      }();\n\n      this.editor.create();\n    },\n    getUpdateForm: function () {\n      var _getUpdateForm = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee3() {\n        var id, res;\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (!this.isUpdate) {\n                  _context3.next = 6;\n                  break;\n                }\n\n                id = this.$route.params.id;\n                _context3.next = 4;\n                return getOneArticleInfo({\n                  id: id\n                });\n\n              case 4:\n                res = _context3.sent;\n\n                if (res.code === 200) {\n                  this.form.contentHtml = res.data.contentHtml;\n                  this.form.title = res.data.title;\n                  this.beforeArticleImgs = JSON.parse(JSON.stringify(res.data.articleImgs));\n                  this.form.articleImgs = res.data.articleImgs;\n                  this.form.id = id;\n                  this.editor.txt.html(this.form.contentHtml);\n                }\n\n              case 6:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function getUpdateForm() {\n        return _getUpdateForm.apply(this, arguments);\n      }\n\n      return getUpdateForm;\n    }(),\n    //点击发表文章\n    sendArticleEvent: function () {\n      var _sendArticleEvent = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee5() {\n        var _this3 = this;\n\n        var html;\n        return regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                html = this.editor.txt.html();\n                this.form.articleImgs.forEach(\n                /*#__PURE__*/\n                function () {\n                  var _ref3 = _asyncToGenerator(\n                  /*#__PURE__*/\n                  regeneratorRuntime.mark(function _callee4(item) {\n                    return regeneratorRuntime.wrap(function _callee4$(_context4) {\n                      while (1) {\n                        switch (_context4.prev = _context4.next) {\n                          case 0:\n                            if (html.includes(item)) {\n                              _context4.next = 4;\n                              break;\n                            }\n\n                            _this3.form.articleImgs = _this3.form.articleImgs.filter(function (value) {\n                              return value !== item;\n                            });\n                            _context4.next = 4;\n                            return deleteImg({\n                              url: item\n                            });\n\n                          case 4:\n                          case \"end\":\n                            return _context4.stop();\n                        }\n                      }\n                    }, _callee4);\n                  }));\n\n                  return function (_x4) {\n                    return _ref3.apply(this, arguments);\n                  };\n                }());\n                this.isNext = false;\n                this.form.userId = this.userId;\n                this.form.contentText = this.editor.txt.text().slice(0, 120);\n                this.form.contentHtml = html;\n\n                if (!(!this.form.title || !this.form.contentHtml)) {\n                  _context5.next = 8;\n                  break;\n                }\n\n                return _context5.abrupt(\"return\", this.$utils.elMessageBox(\"请输入文章标题或内容\", \"warning\"));\n\n              case 8:\n                if (!this.isUpdate) {\n                  _context5.next = 15;\n                  break;\n                }\n\n                _context5.next = 11;\n                return articleUpdate(this.form);\n\n              case 11:\n                this.$utils.elMessageBox(\"修改文章成功\", \"success\", 500);\n                setTimeout(function () {\n                  _this3.$router.push(\"/article/details/\".concat(_this3.form.id));\n                }, 700);\n                _context5.next = 18;\n                break;\n\n              case 15:\n                _context5.next = 17;\n                return articleSendApi(this.form);\n\n              case 17:\n                this.$router.push(\"/\");\n\n              case 18:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function sendArticleEvent() {\n        return _sendArticleEvent.apply(this, arguments);\n      }\n\n      return sendArticleEvent;\n    }(),\n    outDelArticleImgs: function outDelArticleImgs() {\n      var _this4 = this;\n\n      if (!this.beforeArticleImgs.length) {\n        this.form.articleImgs.forEach(\n        /*#__PURE__*/\n        function () {\n          var _ref4 = _asyncToGenerator(\n          /*#__PURE__*/\n          regeneratorRuntime.mark(function _callee6(item) {\n            return regeneratorRuntime.wrap(function _callee6$(_context6) {\n              while (1) {\n                switch (_context6.prev = _context6.next) {\n                  case 0:\n                    _context6.next = 2;\n                    return deleteImg({\n                      url: item\n                    });\n\n                  case 2:\n                  case \"end\":\n                    return _context6.stop();\n                }\n              }\n            }, _callee6);\n          }));\n\n          return function (_x5) {\n            return _ref4.apply(this, arguments);\n          };\n        }());\n      } else if (JSON.stringify(this.form.articleImgs) !== JSON.stringify(this.beforeArticleImgs)) {\n        this.form.articleImgs.forEach(\n        /*#__PURE__*/\n        function () {\n          var _ref5 = _asyncToGenerator(\n          /*#__PURE__*/\n          regeneratorRuntime.mark(function _callee7(item) {\n            return regeneratorRuntime.wrap(function _callee7$(_context7) {\n              while (1) {\n                switch (_context7.prev = _context7.next) {\n                  case 0:\n                    if (_this4.beforeArticleImgs.some(function (value) {\n                      return value === item;\n                    })) {\n                      _context7.next = 3;\n                      break;\n                    }\n\n                    _context7.next = 3;\n                    return deleteImg({\n                      url: item\n                    });\n\n                  case 3:\n                  case \"end\":\n                    return _context7.stop();\n                }\n              }\n            }, _callee7);\n          }));\n\n          return function (_x6) {\n            return _ref5.apply(this, arguments);\n          };\n        }());\n      }\n    }\n  },\n  beforeDestroy: function beforeDestroy() {\n    // 销毁编辑器\n    this.editor.destroy();\n    this.editor = null;\n    this.form = null;\n  }\n};",{"version":3,"sources":["sendArticle.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAiBA,OAAA,CAAA,MAAA,YAAA;AACA,SAAA,cAAA,EAAA,aAAA,EAAA,iBAAA,EAAA,SAAA,EAAA,mBAAA,QAAA,WAAA;AACA,eAAA;AACA,EAAA,IAAA,EAAA,aADA;AAEA,EAAA,IAFA,kBAEA;AACA,WAAA;AACA,MAAA,IAAA,EAAA;AACA;AACA,QAAA,KAAA,EAAA,EAFA;AAGA;AACA,QAAA,WAAA,EAAA,EAJA;AAKA;AACA,QAAA,WAAA,EAAA,EANA;AAOA;AACA,QAAA,MAAA,EAAA,KAAA,MARA;AASA;AACA,QAAA,WAAA,EAAA;AAVA,OADA;AAaA,MAAA,iBAAA,EAAA,EAbA;AAcA,MAAA,MAAA,EAAA,IAdA;AAeA,MAAA,OAAA,EAAA,IAfA;AAgBA,MAAA,QAAA,EAAA,KAAA,MAAA,CAAA,IAAA,IAAA,eAhBA;AAiBA,MAAA,MAAA,EAAA;AAjBA,KAAA;AAmBA,GAtBA;AAwBA;AACA,EAAA,gBAzBA,4BAyBA,EAzBA,EAyBA,IAzBA,EAyBA,IAzBA,EAyBA;AAAA;;AACA;AACA,QAAA,CAAA,KAAA,MAAA,EAAA,OAAA,IAAA,EAAA,CAFA,CAGA;;AACA,QAAA,KAAA,MAAA,CAAA,OAAA,CAAA,gBAAA,EAAA;AACA,WAAA,MAAA,CAAA,MAAA,CAAA,kBAAA,EAAA,KAAA;AACA,WAAA,iBAAA;AACA,aAAA,IAAA,EAAA;AACA;;AACA,QAAA,KAAA,IAAA,CAAA,KAAA,IAAA,KAAA,MAAA,CAAA,GAAA,CAAA,IAAA,EAAA,EAAA;AACA,WAAA,QAAA,CAAA,0CAAA,EAAA,IAAA,EAAA;AACA,QAAA,iBAAA,EAAA,IADA;AAEA,QAAA,gBAAA,EAAA,IAFA;AAGA,QAAA,IAAA,EAAA;AAHA,OAAA,EAKA,IALA,CAKA,YAAA;AACA,QAAA,KAAA,CAAA,iBAAA;;AACA,QAAA,IAAA;AACA,OARA,EASA,KATA,CASA,YAAA;AACA,eAAA,KAAA;AACA,OAXA;AAYA,KAbA,MAaA;AACA,MAAA,IAAA;AACA;AACA,GAlDA;AAmDA,EAAA,OAnDA,qBAmDA;AACA,SAAA,UAAA;AACA,SAAA,aAAA;AACA,GAtDA;AAuDA,EAAA,QAAA,EAAA;AACA,IAAA,MADA,oBACA;AACA,aAAA,KAAA,MAAA,CAAA,OAAA,CAAA,OAAA,CAAA,GAAA;AACA,KAHA;AAIA,IAAA,KAJA,mBAIA;AACA,aAAA,KAAA,MAAA,CAAA,OAAA,CAAA,QAAA;AACA;AANA,GAvDA;AA+DA,EAAA,OAAA,EAAA;AACA;AACA,IAAA,UAFA,wBAEA;AAAA;;AACA,WAAA,MAAA,GAAA,IAAA,CAAA,CAAA,SAAA,CAAA,CADA,CAEA;;AACA,WAAA,MAAA,CAAA,MAAA,CAAA,MAAA,GAAA,GAAA,CAHA,CAIA;;AACA,WAAA,MAAA,CAAA,MAAA,CAAA,MAAA,GAAA,GAAA;AACA,WAAA,MAAA,CAAA,MAAA,CAAA,WAAA,GAAA,SAAA,CANA,CAOA;;AACA,WAAA,MAAA,CAAA,MAAA,CAAA,YAAA,GAAA,CAAA,OAAA,CAAA,CARA,CASA;;AACA,WAAA,MAAA,CAAA,MAAA,CAAA,MAAA,GAAA,CAAA,SAAA,EAAA,SAAA,EAAA,SAAA,EAAA,SAAA,EAAA,SAAA,EAAA,SAAA,EAAA,SAAA,EAAA,SAAA,EAAA,SAAA,EAAA,SAAA,EAAA,SAAA,EAAA,SAAA,CAAA,CAVA,CAWA;;AACA,WAAA,MAAA,CAAA,MAAA,CAAA,WAAA,GAAA,CAAA,GAAA,EAAA,KAAA,EAAA,KAAA,EAAA,GAAA,EAAA,KAAA,EAAA,GAAA,CAAA,CAZA,CAaA;;AACA,WAAA,MAAA,CAAA,MAAA,CAAA,gBAAA,GAAA,KAAA;AACA,WAAA,MAAA,CAAA,MAAA,CAAA,cAAA,GAAA,KAAA,CAfA,CAgBA;;AACA,WAAA,MAAA,CAAA,MAAA,CAAA,WAAA,GAAA,KAAA,CAjBA,CAkBA;;AACA,WAAA,MAAA,CAAA,MAAA,CAAA,gBAAA,GAAA,KAAA,IAAA,CAnBA,CAoBA;;AACA,WAAA,MAAA,CAAA,MAAA,CAAA,kBAAA,GAAA,CAAA,CArBA,CAsBA;;AACA,WAAA,MAAA,CAAA,MAAA,CAAA,gBAAA,GAAA,IAAA,IAAA,GAAA,IAAA,CAvBA,CAuBA;AAEA;;AACA,WAAA,MAAA,CAAA,MAAA,CAAA,eAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gCAAA,kBAAA,WAAA,EAAA,WAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,kBAAA,QADA,GACA,IAAA,QAAA,EADA;AAEA,kBAAA,WAAA,CAAA,OAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4CAAA,iBAAA,IAAA;AAAA;AAAA;AAAA;AAAA;AACA,8BAAA,QAAA,CAAA,MAAA,CAAA,YAAA,EAAA,IAAA;;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAAA;;AAAA;AAAA;AAAA;AAAA;AAFA;AAAA,yBAKA,mBAAA,CAAA,QAAA,CALA;;AAAA;AAKA,kBAAA,GALA;;AAMA,sBAAA,GAAA,CAAA,IAAA,KAAA,GAAA,EAAA;AACA,oBAAA,GAAA,CAAA,IAAA,CAAA,OAAA,CAAA,UAAA,IAAA,EAAA;AACA,sBAAA,WAAA,CAAA,IAAA,CAAA;;AACA,sBAAA,MAAA,CAAA,IAAA,CAAA,WAAA,CAAA,IAAA,CAAA,IAAA;AACA,qBAHA;AAIA;;AAXA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAA;;AAAA;AAAA;AAAA;AAAA;;AAcA,WAAA,MAAA,CAAA,MAAA;AACA,KA3CA;AA4CA,IAAA,aA5CA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBA6CA,KAAA,QA7CA;AAAA;AAAA;AAAA;;AA8CA,gBAAA,EA9CA,GA8CA,KAAA,MAAA,CAAA,MA9CA,CA8CA,EA9CA;AAAA;AAAA,uBA+CA,iBAAA,CAAA;AAAA,kBAAA,EAAA,EAAA;AAAA,iBAAA,CA/CA;;AAAA;AA+CA,gBAAA,GA/CA;;AAgDA,oBAAA,GAAA,CAAA,IAAA,KAAA,GAAA,EAAA;AACA,uBAAA,IAAA,CAAA,WAAA,GAAA,GAAA,CAAA,IAAA,CAAA,WAAA;AACA,uBAAA,IAAA,CAAA,KAAA,GAAA,GAAA,CAAA,IAAA,CAAA,KAAA;AACA,uBAAA,iBAAA,GAAA,IAAA,CAAA,KAAA,CAAA,IAAA,CAAA,SAAA,CAAA,GAAA,CAAA,IAAA,CAAA,WAAA,CAAA,CAAA;AACA,uBAAA,IAAA,CAAA,WAAA,GAAA,GAAA,CAAA,IAAA,CAAA,WAAA;AACA,uBAAA,IAAA,CAAA,EAAA,GAAA,EAAA;AACA,uBAAA,MAAA,CAAA,GAAA,CAAA,IAAA,CAAA,KAAA,IAAA,CAAA,WAAA;AACA;;AAvDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AA0DA;AACA,IAAA,gBA3DA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AA4DA,gBAAA,IA5DA,GA4DA,KAAA,MAAA,CAAA,GAAA,CAAA,IAAA,EA5DA;AA6DA,qBAAA,IAAA,CAAA,WAAA,CAAA,OAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0CAAA,kBAAA,IAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gCACA,IAAA,CAAA,QAAA,CAAA,IAAA,CADA;AAAA;AAAA;AAAA;;AAEA,4BAAA,MAAA,CAAA,IAAA,CAAA,WAAA,GAAA,MAAA,CAAA,IAAA,CAAA,WAAA,CAAA,MAAA,CAAA,UAAA,KAAA;AAAA,qCAAA,KAAA,KAAA,IAAA;AAAA,6BAAA,CAAA;AAFA;AAAA,mCAGA,SAAA,CAAA;AAAA,8BAAA,GAAA,EAAA;AAAA,6BAAA,CAHA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAAA;;AAAA;AAAA;AAAA;AAAA;AAMA,qBAAA,MAAA,GAAA,KAAA;AACA,qBAAA,IAAA,CAAA,MAAA,GAAA,KAAA,MAAA;AACA,qBAAA,IAAA,CAAA,WAAA,GAAA,KAAA,MAAA,CAAA,GAAA,CAAA,IAAA,GAAA,KAAA,CAAA,CAAA,EAAA,GAAA,CAAA;AACA,qBAAA,IAAA,CAAA,WAAA,GAAA,IAAA;;AAtEA,sBAuEA,CAAA,KAAA,IAAA,CAAA,KAAA,IAAA,CAAA,KAAA,IAAA,CAAA,WAvEA;AAAA;AAAA;AAAA;;AAAA,kDAwEA,KAAA,MAAA,CAAA,YAAA,CAAA,YAAA,EAAA,SAAA,CAxEA;;AAAA;AAAA,qBA0EA,KAAA,QA1EA;AAAA;AAAA;AAAA;;AAAA;AAAA,uBA2EA,aAAA,CAAA,KAAA,IAAA,CA3EA;;AAAA;AA4EA,qBAAA,MAAA,CAAA,YAAA,CAAA,QAAA,EAAA,SAAA,EAAA,GAAA;AACA,gBAAA,UAAA,CAAA,YAAA;AACA,kBAAA,MAAA,CAAA,OAAA,CAAA,IAAA,4BAAA,MAAA,CAAA,IAAA,CAAA,EAAA;AACA,iBAFA,EAEA,GAFA,CAAA;AA7EA;AAAA;;AAAA;AAAA;AAAA,uBAiFA,cAAA,CAAA,KAAA,IAAA,CAjFA;;AAAA;AAkFA,qBAAA,OAAA,CAAA,IAAA,CAAA,GAAA;;AAlFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAqFA,IAAA,iBArFA,+BAqFA;AAAA;;AACA,UAAA,CAAA,KAAA,iBAAA,CAAA,MAAA,EAAA;AACA,aAAA,IAAA,CAAA,WAAA,CAAA,OAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kCAAA,kBAAA,IAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2BACA,SAAA,CAAA;AAAA,sBAAA,GAAA,EAAA;AAAA,qBAAA,CADA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAAA;;AAAA;AAAA;AAAA;AAAA;AAGA,OAJA,MAIA,IAAA,IAAA,CAAA,SAAA,CAAA,KAAA,IAAA,CAAA,WAAA,MAAA,IAAA,CAAA,SAAA,CAAA,KAAA,iBAAA,CAAA,EAAA;AACA,aAAA,IAAA,CAAA,WAAA,CAAA,OAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kCAAA,kBAAA,IAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBACA,MAAA,CAAA,iBAAA,CAAA,IAAA,CAAA,UAAA,KAAA;AAAA,6BAAA,KAAA,KAAA,IAAA;AAAA,qBAAA,CADA;AAAA;AAAA;AAAA;;AAAA;AAAA,2BAEA,SAAA,CAAA;AAAA,sBAAA,GAAA,EAAA;AAAA,qBAAA,CAFA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAAA;;AAAA;AAAA;AAAA;AAAA;AAKA;AACA;AAjGA,GA/DA;AAkKA,EAAA,aAlKA,2BAkKA;AACA;AACA,SAAA,MAAA,CAAA,OAAA;AACA,SAAA,MAAA,GAAA,IAAA;AACA,SAAA,IAAA,GAAA,IAAA;AACA;AAvKA,CAAA","sourcesContent":["<template>\n  <div class=\"send-article-box\">\n    <div class=\"send-article\">\n      <div class=\"article-main\">\n        <div class=\"article-box btn-box\">\n          <el-input v-model=\"form.title\" placeholder=\"请输入文章标题\" maxlength=\"88\"></el-input>\n          <el-button type=\"primary\" @click=\"sendArticleEvent\">{{ isUpdate ? \"修改文章\" : \"发表文章\" }}</el-button>\n        </div>\n        <div class=\"article-box\">\n          <div class=\"con-l\" id=\"editor\"></div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport E from \"wangeditor\";\nimport { articleSendApi, articleUpdate, getOneArticleInfo, deleteImg, uploadArticleImgApi } from \"@/api/api\";\nexport default {\n  name: \"sendArticle\",\n  data() {\n    return {\n      form: {\n        //标题\n        title: \"\",\n        //展示部分内容\n        contentText: \"\",\n        //详情全部内容\n        contentHtml: \"\",\n        //用户id\n        userId: this.userId,\n        //图片\n        articleImgs: [],\n      },\n      beforeArticleImgs: [],\n      editor: null,\n      showBtn: true,\n      isUpdate: this.$route.name == \"UpdateArticle\",\n      isNext: true,\n    };\n  },\n\n  //跳转路由前判断是否继续编辑文章\n  beforeRouteLeave(to, from, next) {\n    //路由跳转到哪里\n    if (!this.isNext) return next();\n    //点击退出登录\n    if (this.$store.getters.getReadyLoginOut) {\n      this.$store.commit(\"setReadyLoginOut\", false);\n      this.outDelArticleImgs();\n      return next();\n    }\n    if (this.form.title || this.editor.txt.html()) {\n      this.$confirm(\"你在当前页面已经编辑了文章信息，离开当前页面将会丢失该页面的任何信息。是否继续?\", \"提示\", {\n        confirmButtonText: \"确定\",\n        cancelButtonText: \"取消\",\n        type: \"warning\",\n      })\n        .then(() => {\n          this.outDelArticleImgs();\n          next();\n        })\n        .catch(() => {\n          return false;\n        });\n    } else {\n      next();\n    }\n  },\n  mounted() {\n    this.initEditor();\n    this.getUpdateForm();\n  },\n  computed: {\n    userId() {\n      return this.$store.getters.getUser._id;\n    },\n    token() {\n      return this.$store.getters.getToken;\n    },\n  },\n  methods: {\n    //创建wangEditor富文本编辑器\n    initEditor() {\n      this.editor = new E(\"#editor\");\n      // 设置编辑区域高度\n      this.editor.config.height = 640;\n      //改变默认的z-index\n      this.editor.config.zIndex = 500;\n      this.editor.config.placeholder = \"请输入文章内容\";\n      // 配置菜单栏，设置不需要的菜单\n      this.editor.config.excludeMenus = [\"video\"];\n      // 配置颜色（文字颜色、背景色）\n      this.editor.config.colors = [\"#ffffff\", \"#ff0000\", \"#ff9900\", \"#ffff00\", \"#00ff00\", \"#009933\", \"#3399ff\", \"#0000ff\", \"#000000\", \"#bf4080\", \"#00ffaa\", \"#ff3399\"];\n      // 配置行高\n      this.editor.config.lineHeights = [\"1\", \"1.2\", \"1.5\", \"2\", \"2.5\", \"3\"];\n      //来关闭样式过滤\n      this.editor.config.pasteFilterStyle = false;\n      this.editor.config.pasteIgnoreImg = false;\n      //隐藏网络图片\n      this.editor.config.showLinkImg = false;\n      // 上传超时时间\n      this.editor.config.uploadImgTimeout = 15 * 1000;\n      // 当次最多上传图片个数\n      this.editor.config.uploadImgMaxLength = 5;\n      // 图片大小最大为2M\n      this.editor.config.uploadImgMaxSize = 2 * 1024 * 1024; // 2M\n\n      // resultFiles 是 input 中选中的文件列表; insertImgFn 是获取图片 url 后，插入到编辑器的方法\n      this.editor.config.customUploadImg = async (resultFiles, insertImgFn) => {\n        const formData = new FormData();\n        resultFiles.forEach(async (item) => {\n          formData.append(\"articleImg\", item);\n        });\n        const res = await uploadArticleImgApi(formData);\n        if (res.code === 200) {\n          res.data.forEach((item) => {\n            insertImgFn(item);\n            this.form.articleImgs.push(item);\n          });\n        }\n      };\n\n      this.editor.create();\n    },\n    async getUpdateForm() {\n      if (this.isUpdate) {\n        const { id } = this.$route.params;\n        const res = await getOneArticleInfo({ id });\n        if (res.code === 200) {\n          this.form.contentHtml = res.data.contentHtml;\n          this.form.title = res.data.title;\n          this.beforeArticleImgs = JSON.parse(JSON.stringify(res.data.articleImgs));\n          this.form.articleImgs = res.data.articleImgs;\n          this.form.id = id;\n          this.editor.txt.html(this.form.contentHtml);\n        }\n      }\n    },\n    //点击发表文章\n    async sendArticleEvent() {\n      const html = this.editor.txt.html();\n      this.form.articleImgs.forEach(async (item) => {\n        if (!html.includes(item)) {\n          this.form.articleImgs = this.form.articleImgs.filter((value) => value !== item);\n          await deleteImg({ url: item });\n        }\n      });\n      this.isNext = false;\n      this.form.userId = this.userId;\n      this.form.contentText = this.editor.txt.text().slice(0, 120);\n      this.form.contentHtml = html;\n      if (!this.form.title || !this.form.contentHtml) {\n        return this.$utils.elMessageBox(\"请输入文章标题或内容\", \"warning\");\n      }\n      if (this.isUpdate) {\n        await articleUpdate(this.form);\n        this.$utils.elMessageBox(\"修改文章成功\", \"success\", 500);\n        setTimeout(() => {\n          this.$router.push(`/article/details/${this.form.id}`);\n        }, 700);\n      } else {\n        await articleSendApi(this.form);\n        this.$router.push(\"/\");\n      }\n    },\n    outDelArticleImgs() {\n      if (!this.beforeArticleImgs.length) {\n        this.form.articleImgs.forEach(async (item) => {\n          await deleteImg({ url: item });\n        });\n      } else if (JSON.stringify(this.form.articleImgs) !== JSON.stringify(this.beforeArticleImgs)) {\n        this.form.articleImgs.forEach(async (item) => {\n          if (!this.beforeArticleImgs.some((value) => value === item)) {\n            await deleteImg({ url: item });\n          }\n        });\n      }\n    },\n  },\n  beforeDestroy() {\n    // 销毁编辑器\n    this.editor.destroy();\n    this.editor = null;\n    this.form = null;\n  },\n};\n</script>\n\n<style scoped lang=\"less\">\n.send-article-box {\n  display: flex;\n  width: 100%;\n  justify-content: center;\n  align-items: center;\n}\n.send-article {\n  border-radius: 10px;\n  width: 1080px;\n  margin-top: 20px;\n  padding: 0 15px;\n  box-shadow: 0 0px 30px 3px #aaa;\n  // display: flex;\n  // flex-direction: column;\n  // align-items: center;\n\n  .article-main {\n    margin-bottom: 10px;\n    // width: 1000px;\n    // height: 560px;\n  }\n  // .column{\n  //   display: flex;\n  //   flex-direction: column;\n  // }\n  .article-box {\n    text-align: left;\n    margin-top: 10px;\n\n    .el-input ::v-deep {\n      position: static;\n\n      .el-input__inner {\n        border-radius: 10px;\n      }\n    }\n    .el-textarea ::v-deep {\n      margin-top: 10px;\n      position: static;\n\n      .el-textarea__inner {\n        border-radius: 10px;\n      }\n    }\n    // label{\n    //   font-size: 20px;\n    //   letter-spacing: 5px;\n    //   font-weight: 520;\n    //   width: 60px;\n    // }\n  }\n\n  // .article-box:nth-child(2){\n  //   width: 1200px;\n  // .con-l{\n  //   display: flex;\n  //   width: 960px;\n  // }\n\n  //   .con-r{\n  //     position: relative;\n  //     right: 0;\n  //     top: -97px;\n  //     height: 190px;\n  //     border-radius: 7px;\n  //     box-shadow: 0 0px 30px 3px #AAA;\n  //     margin-left: 30px;\n  //     width: 190px;\n  //   }\n  // }\n\n  // .con-r ::v-deep{\n  //   .el-upload-dragger{\n  //     width: 190px;\n  //     height: 190px;\n  //     border: 1px solid #d9d9d9;\n  //     position: static;\n  //   }\n  //   .el-upload-dragger:hover{\n  //     border: 1px solid #409EFF;\n  //   }\n  // }\n\n  .btn-box {\n    display: flex;\n    align-items: center;\n    .el-button {\n      margin-left: 10px;\n      border-radius: 10px;\n      padding: 12px 8px;\n      letter-spacing: 5px;\n    }\n  }\n\n  .el-button--danger {\n    color: #fff;\n    border: 1px solid #0099ff;\n    background-color: #0099ff;\n\n    &:hover {\n      border: 1px solid #015bf1;\n      background-color: #015bf1;\n    }\n  }\n}\n/deep/ .w-e-toolbar {\n  border-top-left-radius: 10px !important;\n  border-top-right-radius: 10px !important;\n}\n/deep/ .w-e-text-container {\n  border-bottom-left-radius: 10px !important;\n  border-bottom-right-radius: 10px !important;\n}\n</style>"],"sourceRoot":"src/views/article/sendArticle"}]}